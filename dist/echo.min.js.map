{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/echo.js","src/index.js","src/patch.js","src/util.js"],"names":["f","exports","module","define","amd","window","global","self","this","echo","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","_patch","_util","observerOptions","childList","attributes","characterData","subtree","Echo","node","_classCallCheck","vnode","cloneNode","observer","MutationObserver","onChange","bind","observe","disconnect","renderer","render","scheduleRender","default","getNode","dispatchEvent","CustomEvent","bubbles","cancelable","document","contains","update","arguments","undefined","getElement","index","echos","findIndex","getVNode","_echo2","push","_echo","destroy","splice","patch","nodeType","nodeName","parentNode","replaceChild","data","nodeChildNodes","childNodes","vnodeChildNodes","Math","min","isEqualNode","nodeAttrs","vnodeAttrs","_i","removeChild","frag","createDocumentFragment","_i2","appendChild","_i3","name","hasAttribute","removeAttribute","_i4","attr","_name","value","getAttribute","setAttribute","frame","documentElement","querySelector","callback","requestAnimationFrame","batch","pop"],"mappings":"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","file":"echo.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/**\r\n * Import dependencies\r\n */\r\nimport patch from './patch';\r\nimport { scheduleRender } from './util';\r\n\r\n/**\r\n * MutationObserver options\r\n */\r\nconst observerOptions = {\r\n    childList: true,\r\n    attributes: true,\r\n    characterData: true,\r\n    subtree: true\r\n};\r\n\r\n/**\r\n * Virtual DOM class\r\n *\r\n * @class Echo\r\n * @api private\r\n */\r\nexport default class Echo {\r\n\r\n    /**\r\n     * Instantiate the class providing the\r\n     * DOM node to create a virtual DOM clone\r\n     * out of\r\n     *\r\n     * @constructor\r\n     * @param {Element} node\r\n     * @api private\r\n     */\r\n    constructor(node) {\r\n        this.node = node;\r\n        this.vnode = this.node.cloneNode(true);\r\n        this.observer = new MutationObserver(this.onChange.bind(this));\r\n        this.observer.observe(this.vnode, observerOptions);\r\n    }\r\n\r\n    /**\r\n     * Disconnect the mutation observer\r\n     * and nullify the properties\r\n     *\r\n     * @api private\r\n     */\r\n    destroy() {\r\n        if (this.observer) {\r\n            this.observer.disconnect();\r\n            this.observer = this.node = this.vnode = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the source DOM node\r\n     *\r\n     * @return {Element}\r\n     * @api private\r\n     */\r\n    getNode() {\r\n        return this.node;\r\n    }\r\n\r\n    /**\r\n     * Get the virtual DOM node\r\n     *\r\n     * @return {Element}\r\n     * @api private\r\n     */\r\n    getVNode() {\r\n        return this.vnode;\r\n    }\r\n\r\n    /**\r\n     * Schedule a frame to update the\r\n     * source DOM tree\r\n     *\r\n     * @api private\r\n     */\r\n    update() {\r\n        if (!this.renderer) {\r\n            this.renderer = this.render.bind(this);\r\n            scheduleRender(this.renderer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render the changes of the virtual\r\n     * DOM tree to the source DOM tree\r\n     *\r\n     * @api private\r\n     */\r\n    render() {\r\n        this.renderer = null;\r\n        patch(this.node, this.vnode);\r\n        this.getNode().dispatchEvent(new CustomEvent('patch', {\r\n            bubbles: false,\r\n            cancelable: false\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Called anytime a change is made to\r\n     * the virtual DOM tree\r\n     *\r\n     * @api private\r\n     */\r\n    onChange() {\r\n        if (document.contains(this.getNode())) {\r\n            this.update();\r\n            return;\r\n        }\r\n        this.render();\r\n    }\r\n}\r\n","/**\r\n * Import dependencies\r\n */\r\nimport Echo from './echo';\r\nimport { getElement } from './util';\r\n\r\n/**\r\n * Cache of all `Echo` instances\r\n */\r\nconst echos = [];\r\n\r\n/**\r\n * Factory function for creating\r\n * `Echo` instances\r\n *\r\n * @param {Element|String} node (optional)\r\n * @return {Echo}\r\n * @api public\r\n */\r\nexport function echo(node = document) {\r\n    node = getElement(node);\r\n    const index = echos.findIndex((echo) => echo.getNode() === node);\r\n    if (index !== -1) {\r\n        return echos[index].getVNode();\r\n    }\r\n    const echo = new Echo(node);\r\n    echos.push(echo);\r\n    return echo.getVNode();\r\n}\r\n\r\n/**\r\n * Stop future updates\r\n *\r\n * @param {Element} node\r\n * @api public\r\n */\r\nexport function destroy(node) {\r\n    const index = echos.findIndex((echo) => echo.getVNode() === node);\r\n    if (index !== -1) {\r\n        const echo = echos[index];\r\n        echo.destroy();\r\n        echos.splice(index, 1);\r\n    }\r\n}\r\n","/**\r\n * Patch a source node to match\r\n * the virtual node\r\n *\r\n * @param {Element} node\r\n * @param {Element} vnode\r\n * @api private\r\n */\r\nexport default function patch(node, vnode) {\r\n    if (node.nodeType !== vnode.nodeType || node.nodeName !== vnode.nodeName) {\r\n        node.parentNode.replaceChild(vnode.cloneNode(true), node);\r\n        return;\r\n    }\r\n    if (vnode.nodeType === 3) {\r\n        const data = vnode.data;\r\n        if (node.data !== data) {\r\n            node.data = data;\r\n        }\r\n        return;\r\n    }\r\n    const nodeChildNodes = node.childNodes;\r\n    const vnodeChildNodes = vnode.childNodes;\r\n    for (let i = Math.min(nodeChildNodes.length, vnodeChildNodes.length) - 1; i >= 0; i--) {\r\n        patch(nodeChildNodes[i], vnodeChildNodes[i]);\r\n    }\r\n    if (!node.isEqualNode(vnode)) {\r\n        const nodeAttrs = node.attributes;\r\n        const vnodeAttrs = vnode.attributes;\r\n        if (nodeChildNodes.length > vnodeChildNodes.length) {\r\n            for (let i = nodeChildNodes.length - 1; i >= vnodeChildNodes.length; i--) {\r\n                node.removeChild(nodeChildNodes[i]);\r\n            }\r\n        } else if (nodeChildNodes.length < vnodeChildNodes.length) {\r\n            const frag = document.createDocumentFragment();\r\n            for (let i = nodeChildNodes.length; i < vnodeChildNodes.length; i++) {\r\n                frag.appendChild(vnodeChildNodes[i].cloneNode(true));\r\n            }\r\n            node.appendChild(frag);\r\n        }\r\n        for (let i = nodeAttrs.length - 1; i >= 0; i--) {\r\n            const name = nodeAttrs[i].name;\r\n            if (!vnode.hasAttribute(name)) {\r\n                node.removeAttribute(name);\r\n            }\r\n        }\r\n        for (let i = vnodeAttrs.length - 1; i >= 0; i--) {\r\n            const attr = vnodeAttrs[i];\r\n            const name = attr.name;\r\n            const value = attr.value;\r\n            if (node.getAttribute(name) !== value) {\r\n                node.setAttribute(name, value);\r\n            }\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Common variables\r\n */\r\nlet frame;\r\nconst batch = [];\r\n\r\n/**\r\n * Resolve a DOM node to return\r\n * an element node\r\n *\r\n * @param {Element|String} node\r\n * @return {Element}\r\n * @api private\r\n */\r\nexport function getElement(node) {\r\n    if (typeof node === 'string') {\r\n        return document.querySelector(node);\r\n    }\r\n    return node.nodeType === 9 ? node.documentElement : node;\r\n}\r\n\r\n/**\r\n * Schedule a frame to render DOM\r\n * updates\r\n *\r\n * @param {Function} callback\r\n * @api private\r\n */\r\nexport function scheduleRender(callback) {\r\n    if (!frame) {\r\n        frame = requestAnimationFrame(render);\r\n    }\r\n    batch.push(callback);\r\n}\r\n\r\n/**\r\n * Render all the updates\r\n *\r\n * @api private\r\n */\r\nfunction render() {\r\n    frame = null;\r\n    while (batch.length) batch.pop()();\r\n}\r\n"]}